============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\Administrator\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
hypothesis profile 'default'
metadata: {'Python': '3.12.10', 'Platform': 'Windows-11-10.0.26100-SP0', 'Packages': {'pytest': '9.0.2', 'pluggy': '1.6.0'}, 'Plugins': {'anyio': '4.12.1', 'hypothesis': '6.150.0', 'asyncio': '1.3.0', 'cov': '7.0.0', 'json-report': '1.5.0', 'metadata': '3.1.1', 'qt': '4.5.0'}}
PySide6 6.10.1 -- Qt runtime 6.10.1 -- Qt compiled 6.10.1
rootdir: d:\GITHUB\pytQt_template
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.1, hypothesis-6.150.0, asyncio-1.3.0, cov-7.0.0, json-report-1.5.0, metadata-3.1.1, qt-4.5.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 26 items

tests/integration/test_controller_agent_integration.py::test_sm_controller_with_sm_agent_integration[asyncio] PASSED [  3%]
tests/integration/test_controller_agent_integration.py::test_sm_controller_with_state_agent_integration[asyncio] PASSED [  7%]
tests/integration/test_controller_agent_integration.py::test_devqa_controller_with_dev_agent_integration[asyncio] PASSED [ 11%]
tests/integration/test_controller_agent_integration.py::test_devqa_controller_with_qa_agent_integration[asyncio] PASSED [ 15%]
tests/integration/test_controller_agent_integration.py::test_quality_controller_with_ruff_agent_integration[asyncio] PASSED [ 19%]
tests/integration/test_controller_agent_integration.py::test_quality_controller_with_pyright_agent_integration[asyncio] PASSED [ 23%]
tests/integration/test_controller_agent_integration.py::test_quality_controller_with_pytest_agent_integration[asyncio] PASSED [ 26%]
tests/integration/test_controller_agent_integration.py::test_controller_taskgroup_execution[asyncio] PASSED [ 30%]
tests/integration/test_controller_agent_integration.py::test_controller_state_machine_pipeline_integration[asyncio] PASSED [ 34%]
tests/integration/test_controller_agent_integration.py::test_full_sm_to_devqa_pipeline[asyncio] PASSED [ 38%]
tests/integration/test_controller_agent_integration.py::test_controller_error_propagation[asyncio] PASSED [ 42%]
tests/integration/test_controller_agent_integration.py::test_agent_lifecycle_management[asyncio] PASSED [ 46%]
tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_basic_flow[asyncio] PASSED [ 50%]
tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_draft_to_done_single_round[asyncio] PASSED [ 53%]
tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_max_rounds_reached[asyncio] PASSED [ 57%]
tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_with_failed_state[asyncio] PASSED [ 61%]
tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_with_ready_for_review[asyncio] PASSED [ 65%]
tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_ready_for_done_termination[asyncio] PASSED [ 69%]
tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_error_handling[asyncio] FAILED [ 73%]
tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_exception_handling[asyncio] PASSED [ 76%]
tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_agent_execution_error[asyncio] PASSED [ 80%]
tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_termination_states[asyncio] FAILED [ 84%]
tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_non_termination_states[asyncio] PASSED [ 88%]
tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_execute_method[asyncio] PASSED [ 92%]
tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_execute_with_custom_rounds[asyncio] PASSED [ 96%]
tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_story_path_validation[asyncio] PASSED [100%]

================================== FAILURES ===================================
______________ test_devqa_state_machine_error_handling[asyncio] _______________
tests\integration\test_state_machine_pipeline.py:248: in test_devqa_state_machine_error_handling
    assert result is True
E   assert False is True
------------------------------ Captured log call ------------------------------
ERROR    autoBMAD.epic_automation.controllers.devqa_controller:base_controller.py:99 [DevQaController] Failed to parse current status
ERROR    autoBMAD.epic_automation.controllers.devqa_controller:base_controller.py:99 [DevQaController] Failed to parse current status
ERROR    autoBMAD.epic_automation.controllers.devqa_controller:base_controller.py:99 [DevQaController] Failed to parse current status
____________ test_devqa_state_machine_termination_states[asyncio] _____________
tests\integration\test_state_machine_pipeline.py:320: in test_devqa_state_machine_termination_states
    assert result is True, f"State {state} should be termination state"
E   AssertionError: State Failed should be termination state
E   assert False is True
------------------------------ Captured log call ------------------------------
WARNING  autoBMAD.epic_automation.sdk_wrapper:sdk_wrapper.py:568 Could not import cancellation manager: cannot import name 'get_cancellation_manager' from 'autoBMAD.epic_automation.monitoring' (D:\GITHUB\pytQt_template\autoBMAD\epic_automation\monitoring\__init__.py)
WARNING  autoBMAD.epic_automation.sdk_wrapper:sdk_wrapper.py:834 Claude SDK not properly initialized
WARNING  autoBMAD.epic_automation.sdk_wrapper:sdk_wrapper.py:568 Could not import cancellation manager: cannot import name 'get_cancellation_manager' from 'autoBMAD.epic_automation.monitoring' (D:\GITHUB\pytQt_template\autoBMAD\epic_automation\monitoring\__init__.py)
WARNING  autoBMAD.epic_automation.sdk_wrapper:sdk_wrapper.py:834 Claude SDK not properly initialized
WARNING  autoBMAD.epic_automation.sdk_wrapper:sdk_wrapper.py:568 Could not import cancellation manager: cannot import name 'get_cancellation_manager' from 'autoBMAD.epic_automation.monitoring' (D:\GITHUB\pytQt_template\autoBMAD\epic_automation\monitoring\__init__.py)
WARNING  autoBMAD.epic_automation.sdk_wrapper:sdk_wrapper.py:834 Claude SDK not properly initialized
---------------------------- Captured log teardown ----------------------------
WARNING  autoBMAD.epic_automation.core.cancellation_manager:cancellation_manager.py:141 [CancelManager] Timeout waiting for cleanup: 49ee20e7-da0c-451f-b60a-917a9f0d965b (cancel_requested=False, cleanup_completed=True)
WARNING  autoBMAD.epic_automation.core.cancellation_manager:cancellation_manager.py:141 [CancelManager] Timeout waiting for cleanup: b4eca019-e8ad-4a0a-ac90-83fa3ce5e238 (cancel_requested=False, cleanup_completed=True)
WARNING  autoBMAD.epic_automation.core.cancellation_manager:cancellation_manager.py:141 [CancelManager] Timeout waiting for cleanup: 8d399e4a-102f-4528-a246-0bd7854a85a9 (cancel_requested=False, cleanup_completed=True)
============================== warnings summary ===============================
tests/integration/test_controller_agent_integration.py::test_devqa_controller_with_qa_agent_integration[asyncio]
tests/integration/test_controller_agent_integration.py::test_quality_controller_with_ruff_agent_integration[asyncio]
tests/integration/test_controller_agent_integration.py::test_quality_controller_with_pyright_agent_integration[asyncio]
tests/integration/test_controller_agent_integration.py::test_quality_controller_with_pytest_agent_integration[asyncio]
tests/integration/test_controller_agent_integration.py::test_controller_taskgroup_execution[asyncio]
tests/integration/test_controller_agent_integration.py::test_controller_state_machine_pipeline_integration[asyncio]
tests/integration/test_controller_agent_integration.py::test_controller_error_propagation[asyncio]
tests/integration/test_controller_agent_integration.py::test_agent_lifecycle_management[asyncio]
  C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\anyio\_backends\_asyncio.py:2227: DeprecationWarning: task_group fixture is deprecated. Use safe_task_group instead.
    retval = await coro

tests/integration/test_controller_agent_integration.py::test_quality_controller_with_pyright_agent_integration[asyncio]
  C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\threadexception.py:58: PytestUnhandledThreadExceptionWarning: Exception in thread Thread-8 (_readerthread)
  
  Traceback (most recent call last):
    File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
      self.run()
    File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\threading.py", line 1012, in run
      self._target(*self._args, **self._kwargs)
    File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\subprocess.py", line 1599, in _readerthread
      buffer.append(fh.read())
                    ^^^^^^^^^
  UnicodeDecodeError: 'gbk' codec can't decode byte 0xaf in position 309: illegal multibyte sequence
  
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.
    warnings.warn(pytest.PytestUnhandledThreadExceptionWarning(msg))

tests/integration/test_controller_agent_integration.py::test_quality_controller_with_pytest_agent_integration[asyncio]
  C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\_pytest\threadexception.py:58: PytestUnhandledThreadExceptionWarning: Exception in thread Thread-11 (_readerthread)
  
  Traceback (most recent call last):
    File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
      self.run()
    File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\threading.py", line 1012, in run
      self._target(*self._args, **self._kwargs)
    File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\subprocess.py", line 1599, in _readerthread
      buffer.append(fh.read())
                    ^^^^^^^^^
  UnicodeDecodeError: 'gbk' codec can't decode byte 0xaf in position 309: illegal multibyte sequence
  
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.
    warnings.warn(pytest.PytestUnhandledThreadExceptionWarning(msg))

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_error_handling[asyncio]
FAILED tests/integration/test_state_machine_pipeline.py::test_devqa_state_machine_termination_states[asyncio]
================= 2 failed, 24 passed, 10 warnings in 22.91s ==================
