Please fix the Python code in the following file: d:\GITHUB\pytQt_template\autoBMAD\epic_automation\sm_agent.py

BasedPyright type errors (12):  Line 78, Col 13: [unknown] "metadata" 的类型部分未知
  Line 107, Col 20: [reportUnknownVariableType] 返回类型 "dict[str, str | list[Unknown] | None]" 部分未知 (reportUnknownVariableType)
  Line 128, Col 13: [unknown] "append" 的类型部分未知
  Line 131, Col 13: [unknown] "append" 的类型部分未知
  Line 136, Col 13: [unknown] "append" 的类型部分未知
  Line 138, Col 13: [unknown] "append" 的类型部分未知
  Line 143, Col 13: [unknown] "append" 的类型部分未知
  Line 145, Col 9: [unknown] "result" 的类型部分未知
  Line 146, Col 26: [unknown] 部分参数的类型未知
  Line 156, Col 16: [reportUnknownVariableType] 返回类型 "dict[str, bool | list[Unknown]]" 部分未知 (reportUnknownVariableType)
  Line 212, Col 13: [unknown] "story_data" 的类型部分未知
  Line 222, Col 20: [reportUnknownVariableType] 返回类型 "dict[str, str | list[Unknown]]" 部分未知 (reportUnknownVariableType)

Requirements:
1. Fix all the errors listed above
2. Maintain code functionality and readability
3. Follow Python best practices
4. Preserve existing code style where possible
5. Add comments explaining complex fixes if necessary

Please provide the complete fixed file content.
