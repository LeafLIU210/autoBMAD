================================================================================
Dev & QA 代理实现深度分析报告
================================================================================

## 1. 当前代理架构概览

### 1.1 Dev Agent (dev_agent.py) 核心实现

**核心原则:**
- 测试驱动开发（TDD）：先写测试，再实现代码
- 基于故事文档的需求提取：从markdown故事文件中解析需求
- 单一SDK调用执行：通过_execute_single_claude_sdk执行开发任务
- 状态检查机制：跳过已完成的故事或已Ready for Review的故事

**提示词架构:**


**文档交互模式:**
- 读取：故事markdown文件，提取title、acceptance_criteria、tasks、subtasks
- 写入：仅更新Dev Agent Record部分（checkboxes、File List、Status）
- 禁止修改：Story、Acceptance Criteria、Dev Notes等核心业务部分

### 1.2 QA Agent (qa_agent.py) 核心实现

**审查策略:**
- AI驱动质量审查：通过Claude SDK执行QA审查
- 风险评估：基于概率×影响的风险矩阵
- 质量门控：PASS/CONCERNS/FAIL/WAIVED四种状态
- 质量评分：100分制评分系统

**提示词架构:**


**质量门控机制:**
- 文档完整性（70%）：故事标题、状态、验收标准、任务完成
- 工具验证（30%）：基于工具结果评分
- PASS标准：文档完整性100% + 无关键失败 + 工具结果非FAIL
